--ENSINO FUNDAMENTAL
-- 2008
select 
    sc.nr_ano,
    sc.cd_escola,
    m.dc_turno_turma dc_turno,
    sc.nu_sequencial,
    sc.cd_aluno_inep,
    sc.cd_etapa_ceipe,
    'Ensino Fundamental' ds_etapa,
cd_ano_serie_ceipe cd_ano_serie,
    sc.prof_lp,
    sc.prof_lp_erro,
    sc.vl_perc_acertos_lp,
    sc.prof_mt,
    sc.prof_mt_erro,
    sc.vl_perc_acertos_mt,
    sc.fl_avaliado,
	rq_000_001,
	rq_000_002,
	rq_000_003,
	rq_000_004,
	rq_000_005,
	rq_000_006,
	rq_000_007,
	rq_000_008,
	rq_000_009,
	rq_000_010,
	rq_000_011,
	rq_000_012,
	rq_000_013,
	rq_000_014,
	rq_000_015,
	rq_000_016,
	rq_000_017,
	rq_000_018,
	rq_000_019,
	rq_000_020,
	rq_000_021,
	rq_000_022,
	rq_000_023,
	rq_000_024,
	rq_000_025,
	rq_000_026,
	rq_000_027,
	rq_000_028,
	rq_000_029,
	rq_000_030,
	rq_000_031,
	rq_000_032,
	rq_000_033,
	rq_000_034,
	rq_000_035,
	rq_000_036,
	rq_000_037,
	rq_000_038,
	rq_000_039,
	rq_000_040,
	rq_000_041,
	rq_000_042,
	rq_000_043,
	rq_000_044,
	rq_000_045,
	rq_000_046,
	rq_000_047,
	rq_000_048,
	rq_000_049,
	rq_000_050,
	rq_000_051,
	rq_000_052,
	rq_000_053,
	vl_ise
from spaece_contextual.tb_spaece_2008_microdados_aluno m
join  base_identificada.tb_base_spaece_censo sc on  sc.nu_sequencial::text = m.nu_sequencial::text 
               and sc.nr_ano = 2008
               and sc.cd_ano_serie_ceipe in (2,5,9)
 order by  cd_aluno_inep
 
 -- 2009
 /*
  * 
  */
 
 -- 2010
select 
    sc.nr_ano,
    sc.cd_escola,
    m.dc_turno dc_turno,
    sc.nu_sequencial,
    sc.cd_aluno_inep,
    sc.cd_etapa_ceipe,
    'Ensino Fundamental' ds_etapa,
cd_ano_serie_ceipe cd_ano_serie,
    sc.prof_lp,
    sc.prof_lp_erro,
    sc.vl_perc_acertos_lp,
    sc.prof_mt,
    sc.prof_mt_erro,
    sc.vl_perc_acertos_mt,
    sc.fl_avaliado,
	rq_000_001,
	rq_000_002,
	rq_000_046,
	rq_000_004,
	rq_000_005,
	rq_000_006,
	rq_000_007,
	rq_000_008,
	rq_000_009,
	rq_000_010,
	rq_000_011,
	rq_000_012,
	rq_000_013,
	rq_000_014,
	rq_000_015,
	rq_000_016,
	rq_000_017,
	rq_000_018,
	rq_000_019,
	rq_000_020,
	rq_000_021,
	rq_000_022,
	rq_000_023,
	rq_000_024,
	rq_000_025,
	rq_000_026,
	rq_000_027,
	rq_000_028,
	rq_000_028_a,
	rq_000_028_b,
	rq_000_028_c,
	rq_000_028_d,
	rq_000_028_e,
	rq_000_028_f,
	rq_000_028_g,
	rq_000_029,
	rq_000_030,
	rq_000_031,
	rq_000_032,
	rq_000_033,
	rq_000_034,
	rq_000_035,
	rq_000_036,
	rq_000_037,
	rq_000_038,
	rq_000_039,
	rq_000_040,
	rq_000_041,
	rq_000_042,
	rq_000_043,
	rq_000_044,
	rq_000_045,
	fl_quest_nbranco,
	vl_ise
from spaece_contextual.tb_spaece_2010_microdados_aluno m
join  base_identificada.tb_base_spaece_censo sc on  sc.nu_sequencial::text = m.nu_sequencial::text 
               and sc.nr_ano = 2010
               and sc.cd_ano_serie_ceipe in (2,5,9)
 order by  cd_aluno_inep
 
 -- 2011
select 
    sc.nr_ano,
    sc.cd_escola,
    m.dc_turno dc_turno,
    sc.nu_sequencial,
    sc.cd_aluno_inep,
    sc.cd_etapa_ceipe,
    'Ensino Fundamental' ds_etapa,
cd_ano_serie_ceipe cd_ano_serie,
    sc.prof_lp,
    sc.prof_lp_erro,
    sc.vl_perc_acertos_lp,
    sc.prof_mt,
    sc.prof_mt_erro,
    sc.vl_perc_acertos_mt,
    sc.fl_avaliado,
    rf_000_001,
	rf_000_002,
	rf_000_003,
	rf_000_004,
	rf_000_005,
	rq_000_003,
	rq_000_001,
	rq_000_002,
	rq_000_004,
	rq_000_005,
	rq_000_006,
	rq_000_007,
	rq_000_008,
	rq_000_009,
	rq_000_010,
	rq_000_011,
	rq_000_012,
	rq_000_013,
	rq_000_014,
	rq_000_015,
	rq_000_016,
	rq_000_017,
	rq_000_018,
	rq_000_019,
	rq_000_020,
	rq_000_021,
	rq_000_022,
	rq_000_023,
	rq_000_024,
	rq_000_025,
	rq_000_026,
	rq_000_027,
	rq_000_028,
	rq_000_029,
	rq_000_030,
	rq_000_031,
	rq_000_032,
	rq_000_033,
	rq_000_034,
	rq_000_035,
	rq_000_036,
	rq_000_037,
	rq_000_038,
	rq_000_039,
	rq_000_040,
	rq_000_041,
	rq_000_042,
	rq_000_043,
	rq_000_044,
	rq_000_045,
	rq_000_046,
	rq_000_047,
	rq_000_048,
	rq_000_049,
	rq_000_050,
	rq_000_051,
	rq_000_052,
	rq_000_053,
	rq_000_054,
	rq_000_055,
	rq_000_056,
	rq_000_057,
	rq_000_058,
	rq_000_059,
	rq_000_060,
	rq_000_061,
	rq_000_062,
	rq_000_063,
	rq_000_064,
	fl_quest_nbranco
from spaece_contextual.tb_spaece_2011_microdados_aluno_ef m
join  base_identificada.tb_base_spaece_censo sc on  sc.nu_sequencial::text = m.nu_sequencial::text 
               and sc.nr_ano = 2011
               and sc.cd_ano_serie_ceipe in (2,5,9)
 order by  cd_aluno_inep
 
 -- 2012
 -- 5 ano
select 
    sc.nr_ano,
    sc.cd_escola,
    m.dc_turno_turma dc_turno,
    sc.nu_sequencial,
    sc.cd_aluno_inep,
    sc.cd_etapa_ceipe,
    'Ensino Fundamental' ds_etapa,
cd_ano_serie_ceipe cd_ano_serie,
    sc.prof_lp,
    sc.prof_lp_erro,
    sc.vl_perc_acertos_lp,
    sc.prof_mt,
    sc.prof_mt_erro,
    sc.vl_perc_acertos_mt,
    sc.fl_avaliado,

    	rq_000_001,
	rq_000_002,
	rq_000_003,
	rq_000_004,
	rq_000_005,
	rq_000_006,
	rq_000_007,
	rq_000_008,
	rq_000_009,
	rq_000_010,
	rq_000_011,
	rq_000_012,
	rq_000_013,
	rq_000_014,
	rq_000_015,
	rq_000_016,
	rq_000_017,
	rq_000_018,
	rq_000_019,
	rq_000_020,
	rq_000_021,
	rq_000_022,
	rq_000_023,
	rq_000_024,
	rq_000_025,
	rq_000_026,
	rq_000_027,
	rq_000_028,
	rq_000_029,
	rq_000_030,
	rq_000_031,
	rq_000_032,
	rq_000_033,
	rq_000_034,
	rq_000_035,
	rq_000_036,
	rq_000_037,
	rq_000_038,
	rq_000_039,
	rq_000_040,
	rq_000_041,
	rq_000_042,
	rq_000_043,
	rq_000_044,
	rq_000_045,
	rq_000_046,
	rq_000_047,
	rq_000_048,
	rq_000_049,
	rq_000_050,
	rq_000_051,
	rq_000_052,
	rq_000_053,
	rq_000_054,
	rq_000_055,
	rq_000_056,
	rq_000_057,
	rq_000_058,
	rq_000_059,
	rq_000_060,
	rq_000_061
from spaece_contextual.tb_spaece_2012_microdados_aluno_5ef m
join  base_identificada.tb_base_spaece_censo sc on  sc.nu_sequencial::text = m.nu_sequencial::text 
               and sc.nr_ano = 2012
               and sc.cd_ano_serie_ceipe in (2,5,9)
 order by  cd_aluno_inep
 
 --9 ano
 select 
    sc.nr_ano,
    sc.cd_escola,
    m.dc_turno_turma dc_turno,
    sc.nu_sequencial,
    sc.cd_aluno_inep,
    sc.cd_etapa_ceipe,
    'Ensino Fundamental' ds_etapa,
cd_ano_serie_ceipe cd_ano_serie,
    sc.prof_lp,
    sc.prof_lp_erro,
    sc.vl_perc_acertos_lp,
    sc.prof_mt,
    sc.prof_mt_erro,
    sc.vl_perc_acertos_mt,
    sc.fl_avaliado,
	rq_000_001,
	rq_000_002,
	rq_000_003,
	rq_000_004,
	rq_000_005,
	rq_000_006,
	rq_000_007,
	rq_000_008,
	rq_000_009,
	rq_000_010,
	rq_000_011,
	rq_000_012,
	rq_000_013,
	rq_000_014,
	rq_000_015,
	rq_000_016,
	rq_000_017,
	rq_000_018,
	rq_000_019,
	rq_000_020,
	rq_000_021,
	rq_000_022,
	rq_000_023,
	rq_000_024,
	rq_000_025,
	rq_000_026,
	rq_000_027,
	rq_000_028,
	rq_000_029,
	rq_000_030,
	rq_000_031,
	rq_000_032,
	rq_000_033,
	rq_000_034,
	rq_000_035,
	rq_000_036,
	rq_000_037,
	rq_000_038,
	rq_000_039,
	rq_000_040,
	rq_000_041,
	rq_000_042,
	rq_000_043,
	rq_000_044,
	rq_000_045,
	rq_000_046,
	rq_000_047,
	rq_000_048,
	rq_000_049,
	rq_000_050,
	rq_000_051,
	rq_000_052,
	rq_000_053,
	rq_000_054,
	rq_000_055,
	rq_000_056,
	rq_000_057,
	rq_000_058,
	rq_000_059,
	rq_000_060,
	rq_000_061,
	rq_000_062,
	rq_000_063,
	rq_000_064,
	rq_000_065,
	rq_000_066,
	rq_000_067,
	rq_000_068,
	rq_000_069,
	rq_000_070,
	rq_000_071,
	vl_erro,
	vl_ise
from spaece_contextual.tb_spaece_2012_microdados_aluno_9ef m
join  base_identificada.tb_base_spaece_censo sc on  sc.nu_sequencial::text = m.nu_sequencial::text 
               and sc.nr_ano = 2012
               and sc.cd_ano_serie_ceipe in (2,5,9)
 order by  cd_aluno_inep

 -- 2013
select 
    sc.nr_ano,
    sc.cd_escola,
    m.dc_turno_turma dc_turno,
    sc.nu_sequencial,
    sc.cd_aluno_inep,
    sc.cd_etapa_ceipe,
    'Ensino Fundamental' ds_etapa,
cd_ano_serie_ceipe cd_ano_serie,
    sc.prof_lp,
    sc.prof_lp_erro,
    sc.vl_perc_acertos_lp,
    sc.prof_mt,
    sc.prof_mt_erro,
    sc.vl_perc_acertos_mt,
    sc.fl_avaliado,
	rp_1,
	rp_2,
	rp_3,
	rp_4,
	rp_5,
	rp_6,
	rp_7,
	rp_8,
	rp_9,
	rp_10,
	rp_11,
	rp_12,
	rp_13,
	rp_14,
	rp_15,
	rp_16,
	rp_17,
	rp_18,
	rp_19,
	rp_20,
	rp_21,
	rp_22,
	rp_23,
	rp_24,
	rp_25,
	rp_26,
	rp_27,
	rp_28,
	rp_29,
	rp_30,
	rp_31,
	rp_32,
	rp_33,
	rp_34,
	rp_35,
	rp_36,
	rp_37,
	rp_38,
	rp_39,
	rp_40,
	rp_41,
	rp_42,
	rp_43,
	rp_44,
	rp_45,
	rp_46,
	rp_47,
	rp_48,
	rp_49,
	rp_50,
	rp_51,
	rp_52,
	rp_53,
	rp_54,
	rp_55,
	rp_56
from spaece_contextual.tb_spaece_2013_microdados_aluno_ef m
join  base_identificada.tb_base_spaece_censo sc on  sc.nu_sequencial::text = m.nu_sequencial::text 
               and sc.nr_ano = 2013
               and sc.cd_ano_serie_ceipe in (2,5,9)
 order by  cd_aluno_inep

-- 2014
select 
    sc.nr_ano,
    sc.cd_escola,
    m.dc_turno_turma dc_turno,
    sc.nu_sequencial,
    sc.cd_aluno_inep,
    sc.cd_etapa_ceipe,
    'Ensino Fundamental' ds_etapa,
cd_ano_serie_ceipe cd_ano_serie,
    sc.prof_lp,
    sc.prof_lp_erro,
    sc.vl_perc_acertos_lp,
    sc.prof_mt,
    sc.prof_mt_erro,
    sc.vl_perc_acertos_mt,
    sc.fl_avaliado,
	rp_001,
	rp_002,
	rp_003,
	rp_004,
	rp_005,
	rp_006,
	rp_007,
	rp_008,
	rp_009,
	rp_010,
	rp_011,
	rp_012,
	rp_013,
	rp_014,
	rp_015,
	rp_016,
	rp_017,
	rp_018,
	rp_019,
	rp_020,
	rp_021,
	rp_022,
	rp_023,
	rp_024,
	rp_025,
	rp_026,
	rp_027,
	rp_028,
	rp_029,
	rp_030,
	rp_031,
	rp_032,
	rp_033,
	rp_034,
	rp_035,
	rp_036,
	rp_037,
	rp_038,
	rp_039,
	rp_040,
	rp_041,
	rp_042,
	rp_043,
	rp_044,
	rp_045,
	rp_046,
	rp_047,
	rp_048,
	rp_049,
	rp_050,
	rp_051,
	rp_052,
	rp_053,
	rp_054,
	rp_055,
	rp_056,
	rp_057,
	rp_058,
	rp_059,
	rp_060,
	rp_061,
	rp_062,
	rp_063,
	rp_064,
	rp_065,
	rp_066,
	rp_067,
	rp_068,
	rp_069,
	rp_070,
	rp_071,
	rp_072,
	rp_073
	filtro_contextual_validos
from spaece_contextual.tb_spaece_2014_microdados_aluno_9ef m
join  base_identificada.tb_base_spaece_censo sc on  sc.nu_sequencial::text = m.nu_sequencial::text 
               and sc.nr_ano = 2014
               and sc.cd_ano_serie_ceipe in (2,5,9)
 order by  cd_aluno_inep
 
 
 
-- 2015
select 
    sc.nr_ano,
    sc.cd_escola,
    m.dc_turno_turma dc_turno,
    sc.nu_sequencial,
    sc.cd_aluno_inep,
    sc.cd_etapa_ceipe,
    'Ensino Fundamental' ds_etapa,
cd_ano_serie_ceipe cd_ano_serie,
    sc.prof_lp,
    sc.prof_lp_erro,
    sc.vl_perc_acertos_lp,
    sc.prof_mt,
    sc.prof_mt_erro,
    sc.vl_perc_acertos_mt,
    sc.fl_avaliado,

from spaece_contextual.tb_spaece_2015_microdados_aluno m
join  base_identificada.tb_base_spaece_censo sc on  sc.nu_sequencial::text = m.nu_sequencial::text 
               and sc.nr_ano = 2015
               and sc.cd_ano_serie_ceipe in (2,5,9)
 order by  cd_aluno_inep

 /*
  * 
  * -- ENSINO MÉDIO --------------------------------------------------------------------------------------------------------------------
  * 
  */
 /*
 2007
 */

-- 2008
select 
    sc.nr_ano,
    sc.cd_escola,
    m.dc_turno_turma dc_turno,
    sc.nu_sequencial,
    sc.cd_aluno_inep,
    sc.cd_etapa_ceipe,
    'Ensino Médio' ds_etapa,
cd_ano_serie_ceipe cd_ano_serie,
    sc.prof_lp,
    sc.prof_lp_erro,
    sc.vl_perc_acertos_lp,
    sc.prof_mt,
    sc.prof_mt_erro,
    sc.vl_perc_acertos_mt,
    sc.fl_avaliado,
	rq_000_001,
	rq_000_002,
	rq_000_003,
	rq_000_004,
	rq_000_005,
	rq_000_006,
	rq_000_007,
	rq_000_008,
	rq_000_009,
	rq_000_010,
	rq_000_011,
	rq_000_012,
	rq_000_013,
	rq_000_014,
	rq_000_015,
	rq_000_016,
	rq_000_017,
	rq_000_018,
	rq_000_019,
	rq_000_020,
	rq_000_021,
	rq_000_022,
	rq_000_023,
	rq_000_024,
	rq_000_025,
	rq_000_026,
	rq_000_027,
	rq_000_028,
	rq_000_029,
	rq_000_030,
	rq_000_031,
	rq_000_032,
	rq_000_033,
	rq_000_034,
	rq_000_035,
	rq_000_036,
	rq_000_037,
	rq_000_038,
	rq_000_039,
	rq_000_040,
	rq_000_041,
	rq_000_042,
	rq_000_043,
	rq_000_044,
	rq_000_045,
	rq_000_046,
	rq_000_047,
	rq_000_048,
	rq_000_049,
	rq_000_050,
	rq_000_051,
	rq_000_052,
	rq_000_053,
	vl_ise
from spaece_contextual.tb_spaece_2008_microdados_aluno m
join  base_identificada.tb_base_spaece_censo sc on  sc.nu_sequencial::text = m.nu_sequencial::text 
               and sc.nr_ano = 2008
               and sc.cd_etapa_ceipe = 3
 order by  cd_aluno_inep 

 --2009--
select 
    sc.nr_ano,
    sc.cd_escola,
    m.dc_turno dc_turno,
    sc.nu_sequencial,
    sc.cd_aluno_inep,
    sc.cd_etapa_ceipe,
    'Ensino Médio' ds_etapa,
    cd_ano_serie_ceipe cd_ano_serie,
    sc.prof_lp,
    sc.prof_lp_erro,
    sc.vl_perc_acertos_lp,
    sc.prof_mt,
    sc.prof_mt_erro,
    sc.vl_perc_acertos_mt,
    sc.fl_avaliado,
	rq_000_001,
	rq_000_002,
	rq_000_003,
	rq_000_004,
	rq_000_005,
	rq_000_006,
	rq_000_007,
	rq_000_008,
	rq_000_009,
	rq_000_010,
	rq_000_011,
	rq_000_012,
	rq_000_013,
	rq_000_014,
	rq_000_015,
	rq_000_016,
	rq_000_017,
	rq_000_018,
	rq_000_019,
	rq_000_020,
	rq_000_021,
	rq_000_022,
	rq_000_023,
	rq_000_024,
	rq_000_025,
	rq_000_026_a,
	rq_000_026_b,
	rq_000_026_c,
	rq_000_026_d,
	rq_000_026_e,
	rq_000_026_f,
	rq_000_026_g,
	rq_000_027,
	rq_000_028,
	rq_000_029,
	rq_000_030,
	rq_000_031,
	rq_000_032,
	rq_000_033,
	rq_000_034,
	rq_000_035,
	rq_000_036,
	rq_000_037,
	rq_000_038,
	rq_000_039,
	rq_000_040,
	rq_000_041,
	rq_000_042,
	rq_000_043
from spaece_contextual.tb_spaece_2009_microdados_aluno m
join  base_identificada.tb_base_spaece_censo sc on  sc.nu_sequencial::text = m.nu_sequencial::text 
               and sc.nr_ano = 2009
               and sc.cd_etapa_ceipe = 3
 order by  cd_aluno_inep


 --2010 -- 
/*
*
*/
 --2011 --
select 
    sc.nr_ano,
    sc.cd_escola,
    m.dc_turno dc_turno,
    sc.nu_sequencial,
    sc.cd_aluno_inep,
    sc.cd_etapa_ceipe,
    'Ensino Médio' ds_etapa,
cd_ano_serie_ceipe cd_ano_serie,
    sc.prof_lp,
    sc.prof_lp_erro,
    sc.vl_perc_acertos_lp,
    sc.prof_mt,
    sc.prof_mt_erro,
    sc.vl_perc_acertos_mt,
    sc.fl_avaliado,
	rq_000_001,
	rq_000_002,
	rq_000_004,
	rq_000_005,
	rq_000_006,
	rq_000_007,
	rq_000_008,
	rq_000_009,
	rq_000_010,
	rq_000_011,
	rq_000_012,
	rq_000_013,
	rq_000_014,
	rq_000_015,
	rq_000_016,
	rq_000_017,
	rq_000_018,
	rq_000_019,
	rq_000_020,
	rq_000_021,
	rq_000_022,
	rq_000_023,
	rq_000_024,
	rq_000_025,
	rq_000_026,
	rq_000_027,
	rq_000_028,
	rq_000_029,
	rq_000_030,
	rq_000_031,
	rq_000_032,
	rq_000_033,
	rq_000_034,
	rq_000_035,
	rq_000_036,
	rq_000_037,
	rq_000_038,
	rq_000_039,
	rq_000_040,
	rq_000_041,
	rq_000_042,
	rq_000_043,
	rq_000_044,
	rq_000_045,
	rq_000_046,
	rq_000_047,
	rq_000_048,
	rq_000_049,
	rq_000_050,
	rq_000_051,
	rq_000_052,
	rq_000_053,
	rq_000_054,
	rq_000_055,
	rq_000_056,
	rq_000_057,
	rq_000_058,
	rq_000_059,
	rq_000_060,
	rq_000_061,
	rq_000_062,
	rq_000_063,
	rq_000_064,
	fl_quest_nbranco
from spaece_contextual.tb_spaece_2011_microdados_aluno_em m
join  base_identificada.tb_base_spaece_censo sc on  sc.nu_sequencial::text = m.nu_sequencial::text 
               and sc.nr_ano = 2011
               and sc.cd_etapa_ceipe = 3
 order by  cd_aluno_inep  
 
 --2012 --

 --2013 --

 --2014 --
with sequencial as(
select 
sc.id_contextual,
lp.nu_sequencial 
from base_identificada.tb_spaece_alinhado lp --where  nr_ano = 2014 and cd_etapa_ceipe = 3
join spaece_contextual.tb_spaece_2014_microdados_aluno_em sc on sc.cd_aluno::text = lp.cd_aluno::text and sc.cd_turma = lp.cd_turma
where sc.cd_aluno is not null and lp.cd_aluno is not null
)
select
    sc.nr_ano,
    sc.cd_escola,
    m.dc_turno_turma dc_turno,
    sc.nu_sequencial,
    sc.cd_aluno_inep,
    sc.cd_etapa_ceipe,
    'Ensino Médio' ds_etapa,
cd_ano_serie_ceipe cd_ano_serie,
    sc.prof_lp,
    sc.prof_lp_erro,
    sc.vl_perc_acertos_lp,
    sc.prof_mt,
    sc.prof_mt_erro,
    sc.vl_perc_acertos_mt,
    sc.fl_avaliado,
	rp_001,
	rp_002,
	rp_003,
	rp_004,
	rp_005,
	rp_006,
	rp_007,
	rp_008,
	rp_009,
	rp_010,
	rp_011,
	rp_012,
	rp_013,
	rp_014,
	rp_015,
	rp_016,
	rp_017,
	rp_018,
	rp_019,
	rp_020,
	rp_021,
	rp_022,
	rp_023,
	rp_024,
	rp_025,
	rp_026,
	rp_027,
	rp_028,
	rp_029,
	rp_030,
	rp_031,
	rp_032,
	rp_033,
	rp_034,
	rp_035,
	rp_036,
	rp_037,
	rp_038,
	rp_039,
	rp_040,
	rp_041,
	rp_042,
	rp_043,
	rp_044,
	rp_045,
	rp_046,
	rp_047,
	rp_048,
	rp_049,
	rp_050,
	rp_051,
	rp_052,
	rp_053,
	rp_054,
	rp_055,
	rp_056,
	rp_057,
	rp_058,
	rp_059,
	rp_060,
	rp_061,
	rp_062,
	rp_063,
	rp_064,
	rp_065,
	rp_066,
	rp_067,
	rp_068,
	rp_069,
	rp_070,
	rp_071,
	rp_072,
	rp_073,
	filtro_contextual_validos
from spaece_contextual.tb_spaece_2014_microdados_aluno_em m
join sequencial s using(id_contextual)
join  base_identificada.tb_base_spaece_censo sc on  sc.nu_sequencial::text = s.nu_sequencial::text 
               and sc.nr_ano = 2014
               and sc.cd_etapa_ceipe = 3
 order by  cd_aluno_inep 

 --2015 --
 -- 1 serie
select
    sc.nr_ano,
    sc.cd_escola,
     case when m.cd_turno_turma  = 1 then 'MANHA'
 	  when m.cd_turno_turma  = 2 then 'TARDE'
 	  when m.cd_turno_turma  = 4 then 'INTEGRAL'
 	  when m.cd_turno_turma  = 18 then 'NOITE'
 	  else 'INTERMEDIARIO' end dc_turno,
    sc.nu_sequencial,
    sc.cd_aluno_inep,
    sc.cd_etapa_ceipe,
    'Ensino Médio' ds_etapa,
    sc.cd_ano_serie_ceipe cd_ano_serie,
    sc.prof_lp,
    sc.prof_lp_erro,
    sc.vl_perc_acertos_lp,
    sc.prof_mt,
    sc.prof_mt_erro,
    sc.vl_perc_acertos_mt,
    sc.fl_avaliado,
	rp_001 ,
	rp_002 ,
	rp_003 ,
	rp_004 ,
	rp_005 ,
	rp_005_a ,
	rp_005_b ,
	rp_005_c ,
	rp_005_d ,
	rp_005_e ,
	rp_005_f ,
	rp_005_g ,
	rp_005_h ,
	rp_005_i ,
	rp_005_j ,
	rp_005_k ,
	rp_005_l ,
	rp_006 ,
	rp_007 ,
	rp_008 ,
	rp_009 ,
	rp_010 ,
	rp_011 ,
	rp_012 ,
	rp_013 ,
	rp_014 ,
	rp_015 ,
	rp_016 ,
	rp_017 ,
	rp_018 ,
	rp_019 ,
	rp_020 ,
	rp_021 ,
	rp_022 ,
	rp_023 ,
	rp_024 ,
	rp_025 ,
	rp_026 ,
	rp_027 ,
	rp_028 ,
	rp_029 ,
	rp_030 ,
	rp_031 ,
	rp_032 ,
	rp_032_a ,
	rp_032_b ,
	rp_032_c ,
	rp_032_d ,
	rp_032_e ,
	rp_032_f ,
	rp_033 ,
	rp_034 ,
	rp_035 ,
	rp_036 ,
	rp_037 ,
	rp_038 ,
	rp_039 ,
	rp_040 ,
	rp_041 ,
	rp_042 ,
	rp_043 ,
	rp_044 ,
	rp_045 ,
	rp_046 ,
	rp_047 ,
	rp_048 ,
	rp_049 ,
	rp_050 ,
	rp_051 ,
	rp_052 ,
	rp_053 ,
	rp_054 ,
	rp_055 ,
	rp_056 ,
	rp_057 ,
	rp_058 ,
	rp_059 ,
	rp_060 ,
	rp_061 ,
	rp_062 ,
	rp_063 ,
	rp_064 ,
	rp_065 ,
	rp_066 ,
	rp_067 ,
	rp_068 ,
	rp_069 ,
	rp_070 ,
	rp_071 ,
	rp_072 ,
	rp_073 ,
	rp_074 ,
	rp_075 ,
	rp_076 ,
	rp_077 ,
	rp_078 ,
	rp_079 ,
	rp_080 ,
	rp_081 ,
	rp_082 ,
	rp_083 ,
	rp_084 ,
	rp_085 ,
	rp_086 ,
	rp_087 ,
	rp_088 ,
	rp_089 ,
	rp_090 ,
	rp_091 ,
	rp_092 ,
	rp_093 ,
	rp_094 ,
	rp_095 ,
	rp_096 ,
	rp_097 ,
	rp_098 ,
	rp_099 ,
	rp_100 ,
	rp_101 ,
	rp_102 ,
	rp_103 ,
	rp_104 ,
	rp_105 ,
	rp_106 ,
	rp_107 ,
	rp_108 ,
	rp_109 ,
	rp_110 ,
	rp_111 ,
	rp_112 ,
	vl_ise,
	vl_ise_erro
from spaece_contextual.tb_spaece_2015_microdados_aluno_1em m
join  base_identificada.tb_base_spaece_censo sc on  sc.nu_sequencial::text = m.nu_sequencial::text 
               and sc.nr_ano = 2015
               and sc.cd_etapa_ceipe = 3
 order by  cd_aluno_inep 
 
 -- 3 serie
 select
    sc.nr_ano,
    sc.cd_escola,
     case when m.cd_turno_turma  = 1 then 'MANHA'
 	  when m.cd_turno_turma  = 2 then 'TARDE'
 	  when m.cd_turno_turma  = 4 then 'INTEGRAL'
 	  when m.cd_turno_turma  = 18 then 'NOITE'
 	  else 'INTERMEDIARIO' end dc_turno,
    sc.nu_sequencial,
    sc.cd_aluno_inep,
    sc.cd_etapa_ceipe,
    'Ensino Médio' ds_etapa,
    sc.cd_ano_serie_ceipe cd_ano_serie,
    sc.prof_lp,
    sc.prof_lp_erro,
    sc.vl_perc_acertos_lp,
    sc.prof_mt,
    sc.prof_mt_erro,
    sc.vl_perc_acertos_mt,
    sc.fl_avaliado,
	rp_001 ,
	rp_002 ,
	rp_003 ,
	rp_004 ,
	rp_005 ,
	rp_006 ,
	rp_007 ,
	rp_008 ,
	rp_009 ,
	rp_010 ,
	rp_011 ,
	rp_012 ,
	rp_013 ,
	rp_014 ,
	rp_015 ,
	rp_016 ,
	rp_017 ,
	rp_018 ,
	rp_019 ,
	rp_020 ,
	rp_021 ,
	rp_022 ,
	rp_023 ,
	rp_024 ,
	rp_025 ,
	rp_026 ,
	rp_027 ,
	rp_028 ,
	rp_029 ,
	rp_030 ,
	rp_031 ,
	rp_032 ,
	rp_033 ,
	rp_034 ,
	rp_035 ,
	rp_036 ,
	rp_037 ,
	rp_038 ,
	rp_039 ,
	rp_040 ,
	rp_041 ,
	rp_042 ,
	rp_043 ,
	rp_044 ,
	rp_045 ,
	rp_046 ,
	rp_047 ,
	rp_048 ,
	rp_049 ,
	rp_050 ,
	rp_051 ,
	rp_052 ,
	rp_053 ,
	rp_054 ,
	rp_055 ,
	rp_056 ,
	rp_057 ,
	rp_058 ,
	rp_059 ,
	rp_060 ,
	rp_061 ,
	rp_062 ,
	rp_063 ,
	rp_064 ,
	rp_065 ,
	rp_066 ,
	rp_067 ,
	rp_068 ,
	rp_069 ,
	rp_070 ,
	rp_071 ,
	rp_072 ,
	rp_073 ,
	vl_ise ,
	vl_ise_erro
from spaece_contextual.tb_spaece_2015_microdados_aluno_3em m
join  base_identificada.tb_base_spaece_censo sc on  sc.nu_sequencial::text = m.nu_sequencial::text 
               and sc.nr_ano = 2015
               and sc.cd_etapa_ceipe = 3
 order by  cd_aluno_inep 

 --2016 --      
 
-- 2017
select 
    sc.nr_ano,
    sc.cd_escola,
    m.dc_turno_turma dc_turno,
    sc.nu_sequencial,
    sc.cd_aluno_inep,
    sc.cd_etapa_ceipe,
    'Ensino Médio' ds_etapa,
cd_ano_serie_ceipe cd_ano_serie,
    sc.prof_lp,
    sc.prof_lp_erro,
    sc.vl_perc_acertos_lp,
    sc.prof_mt,
    sc.prof_mt_erro,
    sc.vl_perc_acertos_mt,
    sc.fl_avaliado,

from spaece_contextual.tb_spaece_2017_microdados_aluno m
join  base_identificada.tb_base_spaece_censo sc on  sc.nu_sequencial::text = m.nu_sequencial::text 
               and sc.nr_ano = 2017
               and sc.cd_etapa_ceipe = 3
 order by  cd_aluno_inep
 
-- 2018
with repetidos as (
select 
cd_escola::bigint, nm_aluno, count(1) 
from spaece_contextual.tb_spaece_2018_microdados_aluno m --where 
where cd_aluno_inep is null
group by 1,2 having count(1) >1    
union 
select 
cd_escola::bigint, nm_aluno, count(1) 
from base_identificada.tb_spaece_alinhado s --where 
where cd_aluno_inep is null
and nr_ano::int = 2018
and s.cd_etapa_ceipe = 3
group by 1,2 having count(1) >1             
)
, base_inep as(
select --57247
    sc.id_spaece_ceipe::int, 
    sc.nr_ano::int,
    sc.cd_escola::bigint,
    '' dc_turno,
    sc.nu_sequencial::text,
    sc.cd_aluno_inep::text,
    sc.cd_etapa_ceipe::int,
    'Ensino Médio' ds_etapa,
    12 cd_ano_serie,
    sc.prof_lp::text,
    sc.prof_lp_erro::text,
    sc.vl_perc_acertos_lp::text,
    sc.prof_mt::text,
    sc.prof_mt_erro::text,
    sc.vl_perc_acertos_mt::text,
    sc.fl_avaliado::int,
	rp_001,
	rp_002,
	rp_003,
	rp_004,
	rp_005,
	rp_006,
	rp_007,
	rp_008,
	rp_009,
	rp_010,
	rp_011,
	rp_012,
	rp_013,
	rp_014,
	rp_015,
	rp_016,
	rp_017,
	rp_018,
	rp_019,
	rp_020,
	rp_021,
	rp_022,
	rp_023,
	rp_024,
	rp_025,
	rp_026,
	rp_027,
	rp_028,
	rp_029,
	rp_030,
	rp_031,
	rp_032,
	rp_033,
	rp_034,
	rp_035,
	rp_036,
	rp_037,
	rp_038,
	rp_039,
	rp_040,
	rp_041,
	rp_042,
	rp_043,
	rp_044,
	rp_045,
	rp_046,
	rp_047,
	rp_048,
	rp_049,
	rp_050,
	fl_quest_nbranco::text,
	fl_quest_nnulo::text
from spaece_contextual.tb_spaece_2018_microdados_aluno m
join  base_identificada.tb_base_spaece_censo sc on  m.cd_aluno_inep::text = sc.cd_aluno_inep::text and sc.cd_escola::bigint = m.cd_escola::bigint 
		where sc.cd_aluno_inep is not null
			   and m.cd_aluno_inep is not null
               and sc.nr_ano = 2018
               and sc.cd_etapa_ceipe = 3
)
,base_s_inep as(
select --57247
    sc.id_spaece_ceipe::int, 
    sc.nr_ano::int,
    sc.cd_escola::bigint,
    '' dc_turno,
    sc.nu_sequencial::text,
    sc.cd_aluno_inep::text,
    sc.cd_etapa_ceipe::int,
    'Ensino Médio' ds_etapa,
    12 cd_ano_serie,
    sc.prof_lp::text,
    sc.prof_lp_erro::text,
    sc.vl_perc_acertos_lp::text,
    sc.prof_mt::text,
    sc.prof_mt_erro::text,
    sc.vl_perc_acertos_mt::text,
    sc.fl_avaliado::int,
	rp_001,
	rp_002,
	rp_003,
	rp_004,
	rp_005,
	rp_006,
	rp_007,
	rp_008,
	rp_009,
	rp_010,
	rp_011,
	rp_012,
	rp_013,
	rp_014,
	rp_015,
	rp_016,
	rp_017,
	rp_018,
	rp_019,
	rp_020,
	rp_021,
	rp_022,
	rp_023,
	rp_024,
	rp_025,
	rp_026,
	rp_027,
	rp_028,
	rp_029,
	rp_030,
	rp_031,
	rp_032,
	rp_033,
	rp_034,
	rp_035,
	rp_036,
	rp_037,
	rp_038,
	rp_039,
	rp_040,
	rp_041,
	rp_042,
	rp_043,
	rp_044,
	rp_045,
	rp_046,
	rp_047,
	rp_048,
	rp_049,
	rp_050,
	fl_quest_nbranco::text,
	fl_quest_nnulo::text
from spaece_contextual.tb_spaece_2018_microdados_aluno m
join  base_identificada.tb_spaece_alinhado sc on  m.nm_aluno = sc.nm_aluno and sc.cd_escola::bigint = m.cd_escola::bigint 
join base_identificada.tb_base_spaece_censo sc2 on sc2.id_spaece_ceipe =sc.id_spaece_ceipe 
		where  m.cd_aluno_inep is null
		       and not exists (select 1 from base_inep b where b.id_spaece_ceipe = sc2.id_spaece_ceipe)
               and sc.nr_ano = 2018
               and sc.cd_etapa_ceipe = 3
               and sc2.cd_aluno_inep is not null
   			   and not exists (select 1 from repetidos r where m.nm_aluno = r.nm_aluno and r.cd_escola::bigint = m.cd_escola::bigint)
   			   and not exists (select 1 from repetidos r where sc.nm_aluno = r.nm_aluno and r.cd_escola::bigint = sc.cd_escola::bigint)
) 
select * from base_inep
union
select * from base_s_inep
 

 --2019 -- 
with inep_aluno as (
select 
b.cd_aluno_inep,
sa.cd_aluno_institucional 
from base_identificada.tb_base_spaece_censo b 
join base_identificada.tb_spaece_alinhado sa on sa.id_spaece_ceipe = b.id_spaece_ceipe 
where sa.nr_ano = 2019
and sa.cd_etapa_ceipe = 3
)
select * 
from spaece_contextual.tb_spaece_2019_microdados_questionario_aluno qa
left join inep_aluno on cd_aluno_institucional::int = qa.cd_aluno::int 
join spaece_contextual.tb_spaece_2019_microdados_resposta_aluno ra on ra.cd_questionario_aluno  = qa.ci_questionario_aluno 
join spaece_contextual.tb_spaece_2019_microdados_alternativa_32 tsma on tsma.ci_alternativa = ra.cd_alternativa 
join spaece_contextual.tb_spaece_2019_microdados_questao_32 tsmqd on tsmqd.ci_questao = tsma.cd_questao 
/* 
 
 select 
 nu_ano_censo,
 count(1) matricula
 from censo_esc_ce.tb_matricula_2007_2018 tm
 where 
 tp_etapa_ensino is not null 
 and tp_dependencia = 2
 group by 1
 union 
  select 
 nu_ano_censo,
 count(1) matricula
 from censo_esc_ce.tb_matricula_2019 tm
 where 
 tp_etapa_ensino is not null 
 and tp_dependencia = 2
 group by 1
  union 
  select 
 nu_ano_censo,
 count(1) matricula
 from censo_esc_ce.tb_matricula_2020 tm
 where 
 tp_etapa_ensino is not null 
 and tp_dependencia = 2
 group by 1
 union 
 select 
 2021 nu_ano_censo,
 count(1) matricula
 from censo_esc_d.tb_matricula
 where 
 tp_etapa_ensino is not null 
 and tp_dependencia = 2
 group by 1
 */
 